{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AÂ³ AI Resume Intelligence</title>
 <link rel="icon" type="image/svg+xml" href="{% static 'a3-favicon.svg' %}">
<link rel="stylesheet" href="{% static 'analysis.css' %}">
</head>

<body>
  <!-- ================= NAVBAR ================= -->
<nav class="navbar">
    <div class="nav-left">
        <div class="logo">
            <div class="logo-mark">A<sup>3</sup></div>
            <div class="logo-divider"></div>
            <div class="logo-text">
                <span>AI Resume</span>
                <small>Intelligence</small>
            </div>
        </div>
    </div>

    <div class="nav-right">
        <div class="user-info">
            <span class="user-icon">ðŸ‘¤</span>
            <span class="username">{{ request.user.username }}</span>
        </div>
        <a href="{% url 'dashboard' %}" class="logout-btn">Dashboard</a>
    </div>
</nav>

<section class="ats-page">

  <div class="ats-card">

    <h2 class="ats-title">Final ATS Score</h2>

    <div class="ats-top">

      <!-- LEFT : SCORE -->
      <div class="score-section reveal">
        <div class="score-ring" data-score="{{ result.weighted_score }}">
          <svg class="progress-ring" width="220" height="220">
            <circle class="ring-bg" cx="110" cy="110" r="90"/>
            <circle class="ring-progress" cx="110" cy="110" r="90"/>
          </svg>
          <div class="score-text">0</div>
        </div>
      </div>

      <!-- RIGHT : BREAKDOWN -->
      <ul class="score-breakdown reveal">
{% for param_name, param_val in result.breakdown.items %}
        <li>
          <span>{{ param_name }}</span>
          <div class="bar" data-value="{{ param_val }}"></div>
          <span>{{ param_val }}</span>
        </li>
{% endfor %}
      </ul>

    </div>

    <h3 class="analysis-title reveal">Full AI Analysis</h3>

    <div class="analysis-box reveal">
      <div id="typing-output">
  {{ analysis_html|safe }}
</div>
    </div>
    <div class="generate-section reveal">
        <a href="{% url 'generate_pdf' resume.id %}">
          <button type="button" class="generate-btn">
            Generate Resume
          </button>
        </a>
      
    </div>

  </div>

</section>

<script>
document.addEventListener("DOMContentLoaded", function(){

  /* =========================
     SCORE CIRCLE + COUNTER
  ========================== */

  const ring = document.querySelector(".ring-progress");
  const scoreRing = document.querySelector(".score-ring");
  const scoreText = document.querySelector(".score-text");

  const finalScore = parseFloat(scoreRing.dataset.score);
  const radius = 90;
  const circumference = 2 * Math.PI * radius;

  ring.style.strokeDasharray = circumference;
  ring.style.strokeDashoffset = circumference;

  const offset = circumference - (finalScore / 100) * circumference;

  setTimeout(() => {
    ring.style.strokeDashoffset = offset;
  }, 300);

  let current = 0;
  const increment = finalScore / 60;

  function animateCounter(){
    current += increment;
    if(current < finalScore){
      scoreText.textContent = current.toFixed(1);
      requestAnimationFrame(animateCounter);
    } else {
      scoreText.textContent = finalScore.toFixed(1);
    }
  }

  animateCounter();

  /* =========================
       PROGRESS BARS
  ========================== */

  document.querySelectorAll(".bar").forEach(bar => {
    const value = parseFloat(bar.dataset.value);
    const percent = value;

    const fill = document.createElement("div");
    fill.style.height = "100%";
    fill.style.width = "0%";
    fill.style.background = "linear-gradient(90deg, #D4AF37, #F5E6A8)";
    fill.style.borderRadius = "10px";
    fill.style.transition = "width 1.2s ease";

    bar.appendChild(fill);

    setTimeout(() => {
      fill.style.width = percent + "%";
    }, 500);
  });

  /* =========================
        SCROLL REVEAL
  ========================== */

  const reveals = document.querySelectorAll(".reveal");

  function revealOnScroll(){
    const windowHeight = window.innerHeight;

    reveals.forEach((el, index) => {
      const elementTop = el.getBoundingClientRect().top;

      if(elementTop < windowHeight - 100){
        setTimeout(() => {
          el.classList.add("active");
        }, index * 150);
      }
    });
  }

  window.addEventListener("scroll", revealOnScroll);
  revealOnScroll();

});
</script>

</body>
</html>